{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from \"@iobroker/adapter-core\";\nimport { getStationDetails } from \"./lib/apiHelper\";\nimport \"./lib/apiHelper\";\n\nclass soliscloud extends utils.Adapter {\n  private intervalId: any;\n  public constructor(options: Partial<utils.AdapterOptions> = {}) {\n    super({\n      ...options,\n      name: \"soliscloud\",\n    });\n    this.on(\"ready\", this.onReady.bind(this));\n    this.on(\"unload\", this.onUnload.bind(this));\n  }\n\n  private async onReady(): Promise<void> {\n    this.log.info(\"Starting soliscloud adapter\");\n\n    if (this.config.plantId != null) {\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.current_consumption`,\n        {\n          type: \"state\",\n          common: {\n            name: \"current_consumption\",\n            type: \"number\",\n            unit: \"kW\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.current_power`,\n        {\n          type: \"state\",\n          common: {\n            name: \"current_power\",\n            type: \"number\",\n            unit: \"kW\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.current_from_net`,\n        {\n          type: \"state\",\n          common: {\n            name: \"current_from_net\",\n            type: \"number\",\n            unit: \"kW\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(`${this.config.plantId}.sold_today`, {\n        type: \"state\",\n        common: {\n          name: \"sold_today\",\n          type: \"number\",\n          unit: \"kWh\",\n          role: \"value\",\n          read: true,\n          write: true,\n        },\n        native: {},\n      });\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.generated_today`,\n        {\n          type: \"state\",\n          common: {\n            name: \"generated_today\",\n            type: \"number\",\n            unit: \"kWh\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.bought_today`,\n        {\n          type: \"state\",\n          common: {\n            name: \"bought_today\",\n            type: \"number\",\n            unit: \"kWh\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.consumption_today`,\n        {\n          type: \"state\",\n          common: {\n            name: \"consumption_today\",\n            type: \"number\",\n            unit: \"kWh\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.battery_percent`,\n        {\n          type: \"state\",\n          common: {\n            name: \"battery_percent\",\n            type: \"number\",\n            unit: \"%\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n\n      await this.setObjectNotExistsAsync(\n        `${this.config.plantId}.battery_current_usage`,\n        {\n          type: \"state\",\n          common: {\n            name: \"battery_current_usage\",\n            type: \"number\",\n            unit: \"kW\",\n            role: \"value\",\n            read: true,\n            write: true,\n          },\n          native: {},\n        },\n      );\n    }\n\n    if (this.config.apiKey && this.config.apiSecret && this.config.plantId) {\n      this.log.info(\n        `Start polling soliscloud, polling every ${this.config.pollInterval} seconds`,\n      );\n      this.intervalId = this.setInterval(async () => {\n        await this.pollSolis();\n      }, this.config.pollInterval * 1000);\n    }\n  }\n\n  private async pollSolis() {\n    this.log.info(\"Polling ?\");\n    const callResult = await getStationDetails(\n      this.config.plantId,\n      this.config.apiKey,\n      this.config.apiSecret,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.current_consumption`,\n      callResult?.current_consumption,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.current_power`,\n      callResult?.current_power,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.current_from_net`,\n      callResult?.current_from_net,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.sold_today`,\n      callResult?.sold_today,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.generated_today`,\n      callResult?.generated_today,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.bought_today`,\n      callResult?.bought_today,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.consumption_today`,\n      callResult?.consumption_today,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.battery_percent`,\n      callResult?.battery_percent,\n    );\n    await this.setStateAsync(\n      `${this.config.plantId}.battery_current_usage`,\n      callResult?.battery_current_usage,\n    );\n  }\n\n  private onUnload(callback: () => void): void {\n    try {\n      this.log.info(\"Stopping soliscloud polling\");\n      this.clearInterval(this.intervalId);\n      callback();\n    } catch (e) {\n      this.log.info(\"Error while stopping polling: \" + e);\n      callback();\n    }\n  }\n}\n\nif (require.main !== module) {\n  module.exports = (options: Partial<utils.AdapterOptions> | undefined) =>\n    new soliscloud(options);\n} else {\n  (() => new soliscloud())();\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA,YAAuB;AACvB,uBAAkC;AAClC,IAAAA,oBAAO;AAEP,MAAM,mBAAmB,MAAM,QAAQ;AAAA,EAE9B,YAAY,UAAyC,CAAC,GAAG;AAC9D,UAAM;AAAA,MACJ,GAAG;AAAA,MACH,MAAM;AAAA,IACR,CAAC;AACD,SAAK,GAAG,SAAS,KAAK,QAAQ,KAAK,IAAI,CAAC;AACxC,SAAK,GAAG,UAAU,KAAK,SAAS,KAAK,IAAI,CAAC;AAAA,EAC5C;AAAA,EAEA,MAAc,UAAyB;AACrC,SAAK,IAAI,KAAK,6BAA6B;AAE3C,QAAI,KAAK,OAAO,WAAW,MAAM;AAC/B,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK,wBAAwB,GAAG,KAAK,OAAO,sBAAsB;AAAA,QACtE,MAAM;AAAA,QACN,QAAQ;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,QACT;AAAA,QACA,QAAQ,CAAC;AAAA,MACX,CAAC;AACD,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,YAAM,KAAK;AAAA,QACT,GAAG,KAAK,OAAO;AAAA,QACf;AAAA,UACE,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,UACT;AAAA,UACA,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAEA,QAAI,KAAK,OAAO,UAAU,KAAK,OAAO,aAAa,KAAK,OAAO,SAAS;AACtE,WAAK,IAAI;AAAA,QACP,2CAA2C,KAAK,OAAO;AAAA,MACzD;AACA,WAAK,aAAa,KAAK,YAAY,YAAY;AAC7C,cAAM,KAAK,UAAU;AAAA,MACvB,GAAG,KAAK,OAAO,eAAe,GAAI;AAAA,IACpC;AAAA,EACF;AAAA,EAEA,MAAc,YAAY;AACxB,SAAK,IAAI,KAAK,WAAW;AACzB,UAAM,aAAa,UAAM;AAAA,MACvB,KAAK,OAAO;AAAA,MACZ,KAAK,OAAO;AAAA,MACZ,KAAK,OAAO;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AACA,UAAM,KAAK;AAAA,MACT,GAAG,KAAK,OAAO;AAAA,MACf,yCAAY;AAAA,IACd;AAAA,EACF;AAAA,EAEQ,SAAS,UAA4B;AAC3C,QAAI;AACF,WAAK,IAAI,KAAK,6BAA6B;AAC3C,WAAK,cAAc,KAAK,UAAU;AAClC,eAAS;AAAA,IACX,SAAS,GAAP;AACA,WAAK,IAAI,KAAK,mCAAmC,CAAC;AAClD,eAAS;AAAA,IACX;AAAA,EACF;AACF;AAEA,IAAI,QAAQ,SAAS,QAAQ;AAC3B,SAAO,UAAU,CAAC,YAChB,IAAI,WAAW,OAAO;AAC1B,OAAO;AACL,GAAC,MAAM,IAAI,WAAW,GAAG;AAC3B;",
  "names": ["import_apiHelper"]
}
