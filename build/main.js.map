{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from \"@iobroker/adapter-core\";\r\nimport { getStationDetails } from \"./lib/apiHelper\";\r\nimport \"./lib/apiHelper\";\r\n\r\nclass soliscloud extends utils.Adapter {\r\n\tprivate intervalId: any;\r\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\r\n\t\tsuper({\r\n\t\t\t...options,\r\n\t\t\tname: \"soliscloud\",\r\n\t\t});\r\n\t\tthis.on(\"ready\", this.onReady.bind(this));\r\n\t\tthis.on(\"unload\", this.onUnload.bind(this));\r\n\t}\r\n\r\n\tprivate async onReady(): Promise<void> {\r\n\t\tthis.log.info(\"Starting soliscloud adapter\");\r\n\t\tthis.validatePlantID(this.config.plantId)\r\n\t\tif (this.config.plantId != null && this.validatePlantID(this.config.plantId)) {\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.current_consumption`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"current_consumption\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kW\",\r\n\t\t\t\t\t\trole: \"value.power.consumed\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.current_power`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"current_power\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kW\",\r\n\t\t\t\t\t\trole: \"value.power.produced\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.current_from_net`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"current_from_net\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kW\",\r\n\t\t\t\t\t\trole: \"value.power\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(`${this.config.plantId}.sold_today`, {\r\n\t\t\t\ttype: \"state\",\r\n\t\t\t\tcommon: {\r\n\t\t\t\t\tname: \"sold_today\",\r\n\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\tunit: \"kWh\",\r\n\t\t\t\t\trole: \"value.energy\",\r\n\t\t\t\t\tread: true,\r\n\t\t\t\t\twrite: true,\r\n\t\t\t\t},\r\n\t\t\t\tnative: {},\r\n\t\t\t});\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.generated_today`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"generated_today\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kWh\",\r\n\t\t\t\t\t\trole: \"value.energy\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.bought_today`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"bought_today\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kWh\",\r\n\t\t\t\t\t\trole: \"value.energy\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.consumption_today`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"consumption_today\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kWh\",\r\n\t\t\t\t\t\trole: \"value.energy\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.battery_percent`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"battery_percent\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"%\",\r\n\t\t\t\t\t\trole: \"value.fill\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tawait this.setObjectNotExistsAsync(\r\n\t\t\t\t`${this.config.plantId}.battery_current_usage`,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"state\",\r\n\t\t\t\t\tcommon: {\r\n\t\t\t\t\t\tname: \"battery_current_usage\",\r\n\t\t\t\t\t\ttype: \"number\",\r\n\t\t\t\t\t\tunit: \"kW\",\r\n\t\t\t\t\t\trole: \"value.power\",\r\n\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\twrite: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnative: {},\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis.log.error(\"No plantID was entered or it contains invalid characters.\");\r\n\t\t}\r\n\r\n\t\tif (this.config.apiKey && this.config.apiSecret && this.validatePlantID(this.config.plantId)) {\r\n\t\t\tthis.log.info(\r\n\t\t\t\t`Start polling soliscloud, polling every ${this.config.pollInterval} seconds`,\r\n\t\t\t);\r\n\t\t\tthis.intervalId = this.setInterval(async () => {\r\n\t\t\t\tawait this.pollSolis();\r\n\t\t\t}, this.config.pollInterval * 1000);\r\n\t\t} else {\r\n\t\t\tthis.log.error(\"No plantID was entered or it contains invalid characters. NOT polling.\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate validatePlantID(plantId: string): boolean {\r\n\t\tconst pattern = /^[a-zA-Z0-9]*$/;\r\n\t\treturn pattern.test(plantId);\r\n\t}\r\n\r\n\tprivate async pollSolis(): Promise<void> {\r\n\t\tconst callResult = await getStationDetails(\r\n\t\t\tthis.config.plantId,\r\n\t\t\tthis.config.apiKey,\r\n\t\t\tthis.config.apiSecret,\r\n\t\t);\r\n\t\tif (callResult) {\r\n\t\t\tthis.log.debug(\"Received result from API call, current consumption should be: \" + callResult.current_consumption);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.current_consumption`,\r\n\t\t\t\tcallResult.current_consumption,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.current_power`,\r\n\t\t\t\tcallResult.current_power,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.current_from_net`,\r\n\t\t\t\tcallResult.current_from_net,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.sold_today`,\r\n\t\t\t\tcallResult.sold_today,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.generated_today`,\r\n\t\t\t\tcallResult.generated_today,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.bought_today`,\r\n\t\t\t\tcallResult.bought_today,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.consumption_today`,\r\n\t\t\t\tcallResult.consumption_today,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.battery_percent`,\r\n\t\t\t\tcallResult.battery_percent,\r\n\t\t\t);\r\n\t\t\tawait this.setStateAsync(\r\n\t\t\t\t`${this.config.plantId}.battery_current_usage`,\r\n\t\t\t\tcallResult.battery_current_usage,\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis.log.debug(\"Did not receive a correct response from the API call\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onUnload(callback: () => void): void {\r\n\t\ttry {\r\n\t\t\tthis.log.info(\"Stopping soliscloud polling\");\r\n\t\t\tthis.clearInterval(this.intervalId);\r\n\t\t\tcallback();\r\n\t\t} catch (e) {\r\n\t\t\tthis.log.info(\"Error while stopping polling: \" + e);\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif (require.main !== module) {\r\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) =>\r\n\t\tnew soliscloud(options);\r\n} else {\r\n\t(() => new soliscloud())();\r\n}\r\n"],
  "mappings": "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",
  "names": ["import_apiHelper"]
}
